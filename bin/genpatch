#!/bin/sh
#
# This tool needs to run 'off Z' (it runs successfully on a Mac)
# This tool has hardcoded directories in it and is meant 
# for openssl right now - it needs to be cleaned up
#
set +x
rm -rf openssl-1.1.1o
tar -xvf openssl-1.1.1o.tar.gz
cd openssl-1.1.1o
git init 
git add .
git commit -m "baseline"
git checkout -b "openssl"

rm -rf /tmp/gitpatches
mkdir /tmp/gitpatches

list=`(cd ~/Downloads/opensslpatch/1.1.1o && ls *.patch)`
for p in $list; do
	if ! ../dopatch $p ; then
		echo "Patch failed" >&2
		exit 4
	fi
	git add .
	name=${p%%.patch}
	git commit -m "${name}"
done
git format-patch main -o /tmp/gitpatches
