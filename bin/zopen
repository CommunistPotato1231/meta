#!/bin/sh
#
# zopen wrapper script to allow single point of entry to zopen
# tooling
#
ME=$(basename $0)
printHelp(){
cat << HELPDOC
zopen alt is a utility for z/OS Open Tools to switch package versions 
for currently installed packages.

Usage: zopen [COMMAND] [OPTION] [PARAMETERS]...

Command:
  init              generate \$rootfs/etc/zopen-config, creates file structure and bootstraps
  build             invokes the build script
  clone             clone a z/OS Open Tools environment
  download          downloads z/OS Open Tools package(s)
  install           installs z/OS Open Tools package(s))
  generate          generate a zopen project
  update-cacert     update the cacert.pem file
  upgrade           upgrades already installed tools
  list              lists information about z/OS Open Tools packages
  query             queries z/OS Open Tools packages
  search            searches remote repo for z/OS Open Tools package
  remove            removes installed z/OS Open Tools packages
  alt               switch local versions of z/OS Open Tools packages
  clean             cleans various aspects of z/OS Open Tools packages

Option:
  -v, --verbose     run in verbose mode
  -h,-?, --help     display this help and exit

Examples:
  zopen alt foo     list the available alternatives for package 'foo'
  zopen --help      display help for zopen
  zopen install foo 
                    install package foo
  zopen alt --select foo
                    list the available alternatives for package 'foo'
                    and allow the user to select an alternative version



Report bugs at https://github.com/ZOSOpenTools/meta/issues .

HELPDOC
}

export bindir="$( cd "$(dirname "$0")" >/dev/null 2>&1 && pwd -P )"

export PATH="${bindir}:${PATH}"
ZOPEN_DONT_PROCESS_CONFIG=1
. "${bindir}/lib/common.inc"

while [ $# -gt 0 ]; do
  case "$1" in
    "alt"|"build"|"clean"|"clone"|"generate"|"init"|"install"|\
    "query"|"remove"|"update-cacert")
      verb="$1"
      shift
      exec "${bindir}/lib/zopen-$verb" "$@"
      ;;
    "download")
      shift
      exec "${bindir}/lib/zopen-install" "$@"
      ;;
    "-h"| "--help" | "-?")
      printHelp
      exit 0
      ;;
    "list")
      shift
      exec "${bindir}/lib/zopen-query" "--list" "$@"
      ;;
    "search")
      shift
      exec "${bindir}/lib/zopen-query" --remote-search "$@"
      ;;
    "upgrade")
      shift
      exec "${bindir}/lib/zopen-install" -u "$@"
      ;;
    "--version")
      if [ -z "$2" ]; then
        name=$ME
      else
        name="$2"
      fi
      exec "${bindir}/lib/zopen-version" $name 
      ;;
    *)
      printError "Unknown option ${1} specified"
      ;;
  esac
  shift;
done

printHelp
